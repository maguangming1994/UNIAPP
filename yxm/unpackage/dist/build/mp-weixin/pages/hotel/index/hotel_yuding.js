(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/hotel/index/hotel_yuding"],{1387:function(t,o,e){"use strict";(function(t){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var i=n(e("3f4c"));function n(t){return t&&t.__esModule?t:{default:t}}getApp();var s={data:function(){return{page_name:"hotel_index_yuding",module:"hotel",is_page_loaded:!1,opt:{},page_data:{user:!1},btn_txt:"获取验证码",room_amount:1,more_room:!1,mobile_number:"",code:"",show_modal:!1,dialogs:{show_times_modal:!1},pre_in_at:"",hours:[],picked_hour:[],rooms:[],total_price:0,picked_date:{}}},onLoad:function(t){this.opt=t,console.log(t)},onShow:function(){this.picked_date=this.get_cache("picked_date"),console.log(this.picked_date),this.start_date=this.picked_date.startDateStr,this.stop_date=this.picked_date.endDateStr,this.room_type=this.picked_date.room_type,this.is_page_loaded||this.onMhcmsPull()},onPullDownRefresh:function(){this.onMhcmsPull(),t.stopPullDownRefresh()},created:function(){this.init_hours(),this.picked_hour=this.hours[0]},watch:{room_amount:function(t){this.get_total_price()}},methods:{get_total_price:function(){this.total_price=this.page_data.room_type.price*this.room_amount*this.picked_date.countDays+this.page_data.room_type.margin*this.room_amount},create_hotel_order:function(){var o=this,e={room_amount:this.room_amount,rooms:this.rooms,room_type_id:this.opt.id,picked_hour:this.picked_hour.hour};if(e.rooms.length<e.room_amount)return this.show_toast("对不起,每一间房最少写一名住客");for(var i in e.rooms)if(i<=e.room_amount&&!e.rooms[i].real_name)return this.show_toast("对不起,每一间房最少写一名住客");e.start=this.picked_date.startDateStr,e.end=this.picked_date.endDateStr,console.log(e),this.show_toast("正在发起支付,请稍后~"),this.bra_common_page(this.module,"create_hotel_order",e,!1,function(e){var i=e.data.page_data;if(console.log(i),6==i.code)return o.get_app_pay_params(i.data.id,"micropay",function(e){console.log(JSON.stringify(e)),t.requestPayment({provider:"wxpay",orderInfo:JSON.stringify(e),success:function(t){o.show_toast("支付完成"),o.onNav({url:"/pages/hotel/user/index",type:"switch"}),console.log("success:"+JSON.stringify(t))},fail:function(t){console.log("fail:"+JSON.stringify(t)),o.show_toast("支付失败！"),o.onNav({url:"/pages/hotel/user/index",type:"switch"})}})});1==i.code?(o.show_toast(i.msg),o.onNav({url:"/pages/hotel/user/index",type:"switch"})):o.show_toast(i.msg)},"post",!1)},change_room:function(t){var o=t.target.dataset,e=t.detail.value;this.rooms[o.room_idx]||(this.rooms[o.room_idx]={}),this.rooms[o.room_idx][o.field_name]=e,console.log(this.rooms,o)},init_hours:function(){this.hours=i.default.get_house_arr(this.start_date)},onMhcmsPull:function(){var o=this,e={};e.id=this.opt.id,e.room_type=this.picked_date.room_type,e.start=this.picked_date.startDateStr,e.end=this.picked_date.endDateStr,this.bra_common_page(this.module,this.page_name,e,!1,function(e){o.page_data=o.elements.page_data,o.is_page_loaded=!0,o.get_total_price(),t.stopPullDownRefresh()})},recount:function(){var t=this;t.count>0?(setTimeout(function(){t.count--,t.recount()},1e3),this.btn_txt=t.count):(t.count=60,this.btn_txt="获取验证码")},send_sms:function(o){var e=this,i=this.bra_service("bra","send_login_verify_code"),n=this,s={mobile:n.mobile_number,is_mixed:2},a=this.fetch(i,s,"post");a.then(function(o){t.showToast({icon:"none",title:"已经发送",duration:2e3}),e.recount()},function(o){setTimeout(function(){t.showToast({icon:"none",title:o.msg,duration:2e3})},100)})},send_verify_code:function(){if(11!=this.mobile_number.length)return this.show_toast("对不起,您的手机号码不正确");this.send_sms(this.mobile_number)},verify_code:function(){var o=this;if(this.code.length<4)return t.showToast({icon:"none",title:"请输入正确的验证码",duration:2e3});var e=this.bra_service("bra","verify_login_code"),i=this,n=this.fetch(e,{mobile:i.mobile_number,code:this.code});n.then(function(e){var i=e.data;i.user?o.log_user_in(i.user,function(){o.onMhcmsPull()}):t.showToast({icon:"none",title:i.msg||"系统错误",duration:2e3}),console.log(i)},function(o){t.showToast({icon:"none",title:o.msg||"系统错误",duration:2e3})})}}};o.default=s}).call(this,e("543d")["default"])},"1a95":function(t,o,e){"use strict";var i=e("b8fb"),n=e.n(i);n.a},"8dde":function(t,o,e){"use strict";(function(t){e("5e7b"),e("921b");i(e("66fd"));var o=i(e("c74e"));function i(t){return t&&t.__esModule?t:{default:t}}t(o.default)}).call(this,e("543d")["createPage"])},b8fb:function(t,o,e){},c3b6:function(t,o,e){"use strict";e.r(o);var i=e("1387"),n=e.n(i);for(var s in i)"default"!==s&&function(t){e.d(o,t,function(){return i[t]})}(s);o["default"]=n.a},c74e:function(t,o,e){"use strict";e.r(o);var i=e("e4a5"),n=e("c3b6");for(var s in n)"default"!==s&&function(t){e.d(o,t,function(){return n[t]})}(s);e("1a95");var a,r=e("f0c5"),u=Object(r["a"])(n["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],a);o["default"]=u.exports},e4a5:function(t,o,e){"use strict";var i,n=function(){var t=this,o=t.$createElement;t._self._c;t._isMounted||(t.e0=function(o){t.more_room=!t.more_room},t.e1=function(o){t.room_amount=t.item,t.more_room=!1},t.e2=function(o){t.dialogs.show_times_modal=!0},t.e3=function(o){t.dialogs.show_times_modal=!1},t.e4=function(o){t.picked_hour=t.hour,t.dialogs.show_times_modal=!1})},s=[];e.d(o,"b",function(){return n}),e.d(o,"c",function(){return s}),e.d(o,"a",function(){return i})}},[["8dde","common/runtime","common/vendor"]]]);