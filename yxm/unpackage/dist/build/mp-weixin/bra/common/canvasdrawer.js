(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["bra/common/canvasdrawer"],{"122f":function(t,e,i){"use strict";var n=i("f71d"),a=i.n(n);a.a},"12e3":function(t,e,i){"use strict";i.r(e);var n=i("9212"),a=i("5a37");for(var r in a)"default"!==r&&function(t){i.d(e,t,function(){return a[t]})}(r);i("122f");var s,o=i("f0c5"),c=Object(o["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);e["default"]=c.exports},"5a37":function(t,e,i){"use strict";i.r(e);var n=i("b674"),a=i.n(n);for(var r in n)"default"!==r&&function(t){i.d(e,t,function(){return n[t]})}(r);e["default"]=a.a},9212:function(t,e,i){"use strict";var n,a=function(){var t=this,e=t.$createElement;t._self._c},r=[];i.d(e,"b",function(){return a}),i.d(e,"c",function(){return r}),i.d(e,"a",function(){return n})},b674:function(t,e,i){"use strict";(function(t){function i(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},a=Object.keys(i);"function"===typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),a.forEach(function(e){n(t,e,i[e])})}return t}function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a={props:{painting:{type:Object}},data:function(){return{showCanvas:!1,width:300,height:300,tempFileList:[],isPainting:!1,ctx:null,cache:Array()}},watch:{painting:function(e,i){t.removeStorageSync("canvasdrawer_pic_cache"),this.ctx=t.createCanvasContext("canvasdrawer",this),this.isPainting||(JSON.stringify(e)!==JSON.stringify(i)?e&&e.width&&e.height&&(this.showCanvas=!0,this.isPainting=!0,this.readyPigment()):e&&"same"!==e.mode&&this.$emit("getImage",{errMsg:"canvasdrawer:samme params"}))}},creatd:function(){t.removeStorageSync("canvasdrawer_pic_cache"),this.ctx=t.createCanvasContext("canvasdrawer",this),console.log(this.ctx,"-----------------------------------------------------------------------------------------------")},methods:{readyPigment:function(){var t=this,e=this.painting.width,i=this.painting.height,n=this.painting.views;this.width=e,this.height=i;var a=setInterval(function(){t.ctx&&(console.log("inter"),clearInterval(a),t.ctx.clearActions(),t.ctx.save(),t.getImagesInfo(n)),console.log("inter A")},100)},getImagesInfo:function(t){for(var e=this,i=[],n=0;n<t.length;n++)"image"===t[n].type&&i.push(this.getImageInfo(t[n].url));for(var a=[],r=function(t){a.push(new Promise(function(e,n){Promise.all(i.splice(8*t,8)).then(function(t){e(t)}).catch(function(t){n(t)})}))},s=0;s<Math.ceil(i.length/8);s++)r(s);Promise.all(a).then(function(t){for(var i=[],n=0;n<t.length;n++)i=i.concat(t[n]);e.tempFileList=i,e.startPainting()})},startPainting:function(){for(var e=this,n=this.tempFileList,a=this.painting.views,r=0,s=0;r<a.length;r++)if("image"===a[r].type)this.drawImage(i({},a[r],{url:n[s]})),s++;else if("text"===a[r].type){if(!this.ctx.measureText)return t.showModal({title:"提示",content:"当前微信版本过低，无法使用 measureText 功能，请升级到最新微信版本后重试。"}),void this.$emit("getImage",{errMsg:"canvasdrawer:version too low"});this.drawText(a[r])}else"rect"===a[r].type&&this.drawRect(a[r]);this.ctx.draw(!1,function(){t.setStorageSync("canvasdrawer_pic_cache",e.cache);var i=t.getSystemInfoSync().system;/ios/i.test(i)?e.saveImageToLocal():setTimeout(function(){e.saveImageToLocal()},800)})},drawImage:function(t){console.log(t),this.ctx.save();var e=t.url,i=t.top,n=void 0===i?0:i,a=t.left,r=void 0===a?0:a,s=t.width,o=void 0===s?0:s,c=t.height,h=void 0===c?0:c,l=(t.borderRadius,t.deg),d=void 0===l?0:l;0!==d?(this.ctx.translate(r+o/2,n+h/2),this.ctx.rotate(d*Math.PI/180),this.ctx.drawImage(e,-o/2,-h/2,o,h)):this.ctx.drawImage(e,r,n,o,h),this.ctx.restore()},drawText:function(t){this.ctx.save();var e=t.MaxLineNumber,n=void 0===e?2:e,a=t.breakWord,r=void 0!==a&&a,s=t.color,o=void 0===s?"black":s,c=t.content,h=void 0===c?"":c,l=t.fontSize,d=void 0===l?16:l,f=t.top,g=void 0===f?0:f,u=t.left,v=void 0===u?0:u,m=t.lineHeight,w=void 0===m?20:m,x=t.textAlign,p=void 0===x?"left":x,b=t.width,I=t.bolder,y=void 0!==I&&I,T=t.textDecoration,P=void 0===T?"none":T;if(this.ctx.beginPath(),this.ctx.setTextBaseline("top"),this.ctx.setTextAlign(p),this.ctx.setFillStyle(o),this.ctx.setFontSize(d),r){for(var S="",L=g,O=1,k=0;k<h.length;k++)if(S+=[h[k]],this.ctx.measureText(S).width>b){if(O===n&&k!==h.length){S=S.substring(0,S.length-1)+"...",this.ctx.fillText(S,v,L),this.drawTextLine(v,L,P,o,d,S),S="";break}this.ctx.fillText(S,v,L),this.drawTextLine(v,L,P,o,d,S),S="",L+=w,O++}this.ctx.fillText(S,v,L),this.drawTextLine(v,L,P,o,d,S)}else this.ctx.fillText(h,v,g),this.drawTextLine(v,g,P,o,d,h);this.ctx.restore(),y&&this.drawText(i({},t,{left:v+.3,top:g+.3,bolder:!1,textDecoration:"none"}))},drawTextLine:function(t,e,i,n,a,r){"underline"===i?this.drawRect({background:n,top:e+1.2*a,left:t-1,width:this.ctx.measureText(r).width+3,height:1}):"line-through"===i&&this.drawRect({background:n,top:e+.6*a,left:t-1,width:this.ctx.measureText(r).width+3,height:1})},drawRect:function(t){this.ctx.save();var e=t.background,i=t.top,n=void 0===i?0:i,a=t.left,r=void 0===a?0:a,s=t.width,o=void 0===s?0:s,c=t.height,h=void 0===c?0:c;this.ctx.setFillStyle(e),this.ctx.fillRect(r,n,o,h),this.ctx.restore()},getImageInfo:function(e){var i=this;return new Promise(function(n,a){if(i.cache[e])n(i.cache[e]);else{var r=new RegExp(/^http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/);r.test(e)?t.getImageInfo({src:e,complete:function(t){"getImageInfo:ok"===t.errMsg?(i.cache[e]=t.path,n(t.path)):(i.$emit("getImage",{errMsg:"canvasdrawer:download fail"}),a(new Error("getImageInfo fail")))}}):(i.cache[e]=e,n(e))}})},saveImageToLocal:function(){var e=this,i=this.width,n=this.height;t.canvasToTempFilePath({x:0,y:0,width:i,height:n,canvasId:"canvasdrawer",complete:function(t){"canvasToTempFilePath:ok"===t.errMsg?(e.showCanvas=!1,e.isPainting=!1,e.tempFileList=[],e.$emit("getImage",{tempFilePath:t.tempFilePath,errMsg:"canvasdrawer:ok"})):e.$emit("getImage",{errMsg:"canvasdrawer:fail"})}},this)}}};e.default=a}).call(this,i("543d")["default"])},f71d:function(t,e,i){}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'bra/common/canvasdrawer-create-component',
    {
        'bra/common/canvasdrawer-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("12e3"))
        })
    },
    [['bra/common/canvasdrawer-create-component']]
]);
